{{- define "main" -}}
<div class="w-full">
    <div class="flex justify-between w-full items-end mb-4">
        <h3
            class="text-2xl sm:text-3xl font-semibold underline decoration-6 sm:decoration-8 decoration-mondrian_red"
        >
            {{- .Title -}}
        </h3>
        <span class="h-max">
            <p class="text-xs font-mono text-mondrian_dark_gray">
                {{- with .Site.Data.changelog.releases -}} {{ len . }} releases
                {{- else -}} version history {{- end -}}
            </p>
        </span>
    </div>

    {{- with .Site.Data.changelog -}} {{- if .releases -}} {{- /* Desktop table
    view */ -}}
    <div
        class="hidden md:block overflow-x-auto mb-4 hover:bg-mondrian_bright_white p-4 border border-mondrian_white hover:border-mondrian_black"
    >
        <table
            class="w-full border-collapse border border-mondrian_white"
            aria-describedby="changelog-note"
        >
            <caption class="sr-only">
                List of software releases and their changes
            </caption>
            <thead>
                <tr
                    class="border-b border-b-mondrian_black bg-mondrian_white text-left font-sans"
                >
                    <th class="w-1/8 pl-1" scope="col">Version</th>
                    <th class="w-1/8 pl-1" scope="col">Date</th>
                    <th class="w-1/8 pl-1" scope="col">Commits</th>
                    <th scope="col">Changes</th>
                </tr>
            </thead>
            <tbody>
                {{- range .releases -}}
                <tr
                    class="border-b border-b-mondrian_light_gray hover:bg-mondrian_light_gray"
                >
                    <td
                        class="text-left font-mono text-xs align-top pt-1 pl-1"
                        scope="row"
                    >
                        {{- if eq .tag "unversioned" -}}
                        <span class="text-mondrian_dark_gray">UNVERSIONED</span>
                        {{- else -}}
                        <a
                            href="https://github.com/natrimmer/synthetic.software/releases/tag/{{- .tag -}}"
                            class="underline hover:text-mondrian_blue transition-colors"
                            target="_blank"
                            rel="noopener noreferrer"
                            >{{- .tag -}}</a
                        >
                        {{- end -}}
                    </td>
                    <td
                        class="text-xs font-mono align-top pt-1 pl-1 text-mondrian_dark_gray"
                    >
                        {{- .date | dateFormat "Jan 2, 2006" -}}
                    </td>
                    <td
                        class="text-xs font-mono align-top pt-1 pl-1 text-center"
                    >
                        {{- len .commits -}}
                    </td>
                    <td class="text-sm align-top py-1 pl-1">
                        {{- if .commits -}}
                        <div class="space-y-1">
                            {{- range .commits -}}
                            <div class="flex items-start gap-2">
                                <span
                                    class="inline-block min-w-[3rem] text-xs text-mondrian_dark_gray font-mono bg-mondrian_light_gray px-1 py-0.5"
                                    >{{- .type -}}</span
                                >
                                <span class="flex-1">{{- .subject -}}</span>
                                <a
                                    href="https://github.com/natrimmer/synthetic.software/commit/{{- .hash -}}"
                                    class="text-xs text-mondrian_dark_gray font-mono hover:text-mondrian_yellow transition-colors"
                                    target="_blank"
                                    rel="noopener noreferrer"
                                    >{{- .hash -}}</a
                                >
                            </div>
                            {{- end -}}
                        </div>
                        {{- end -}}
                    </td>
                </tr>
                {{- end -}}
            </tbody>
            <tfoot id="changelog-note">
                <tr>
                    <th
                        colspan="4"
                        class="text-xs text-mondrian_dark_gray p-1 text-left"
                    >
                        Notes:
                    </th>
                </tr>
                <tr>
                    <td colspan="4" class="text-xs text-mondrian_dark_gray p-1">
                        Changes are grouped by release version, showing all
                        commits included in each version.
                    </td>
                </tr>
                <tr>
                    <td colspan="4" class="text-xs text-mondrian_dark_gray p-1">
                        Commit types: <code class="font-mono">feat</code> (new
                        features), <code class="font-mono">fix</code> (bug
                        fixes),
                        <code class="font-mono">docs</code> (documentation),
                        <code class="font-mono">style</code> (formatting),
                        <code class="font-mono">refactor</code> (code
                        improvements),
                        <code class="font-mono">perf</code> (performance),
                        <code class="font-mono">ci</code> (build/deploy),
                        <code class="font-mono">chore</code> (maintenance).
                    </td>
                </tr>
            </tfoot>
        </table>
    </div>

    {{- /* Mobile card view */ -}}
    <div class="md:hidden space-y-4 mb-4">
        {{- range .releases -}}
        <div
            class="border border-mondrian_black bg-mondrian_white p-4 shadow-mondrian hover:bg-mondrian_bright_white"
        >
            <div class="flex justify-between items-start mb-3">
                <div>
                    {{- if eq .tag "unversioned" -}}
                    <span class="font-mono text-sm text-mondrian_dark_gray"
                        >UNVERSIONED</span
                    >
                    {{- else -}}
                    <a
                        href="https://github.com/natrimmer/synthetic.software/releases/tag/{{- .tag -}}"
                        class="font-mono text-sm underline hover:text-mondrian_blue transition-colors"
                        target="_blank"
                        rel="noopener noreferrer"
                        >{{- .tag -}}</a
                    >
                    {{- end -}}
                    <div class="text-xs font-mono text-mondrian_dark_gray mt-1">
                        {{- .date | dateFormat "Jan 2, 2006" -}}
                    </div>
                </div>
                <div class="text-right">
                    <div
                        class="text-xs font-mono bg-mondrian_light_gray px-2 py-1 border border-mondrian_black"
                    >
                        {{- len .commits -}} commit{{- if ne (len .commits) 1
                        -}}s{{- end -}}
                    </div>
                </div>
            </div>

            {{- if .commits -}}
            <div class="space-y-2">
                {{- range .commits -}}
                <div class="border-l-2 border-mondrian_blue pl-3">
                    <div
                        class="flex flex-col sm:flex-row sm:items-start sm:gap-2"
                    >
                        <span
                            class="inline-block w-fit text-xs text-mondrian_dark_gray font-mono bg-mondrian_light_gray px-1 py-0.5 mb-1 sm:mb-0"
                            >{{- .type -}}</span
                        >
                        <span class="flex-1 text-sm">{{- .subject -}}</span>
                    </div>
                    <div class="mt-1">
                        <a
                            href="https://github.com/natrimmer/synthetic.software/commit/{{- .hash -}}"
                            class="text-xs text-mondrian_dark_gray font-mono hover:text-mondrian_yellow transition-colors"
                            target="_blank"
                            rel="noopener noreferrer"
                            >{{- .hash -}}</a
                        >
                    </div>
                </div>
                {{- end -}}
            </div>
            {{- end -}}
        </div>
        {{- end -}}
    </div>

    {{- /* Mobile notes */ -}}
    <div
        class="md:hidden mb-4 p-4 bg-mondrian_light_gray border border-mondrian_black"
    >
        <h4 class="text-xs text-mondrian_dark_gray font-semibold mb-2">
            Notes:
        </h4>
        <p class="text-xs text-mondrian_dark_gray mb-2">
            Changes are grouped by release version, showing all commits included
            in each version.
        </p>
        <p class="text-xs text-mondrian_dark_gray">
            Commit types: <code class="font-mono">feat</code> (new features),
            <code class="font-mono">fix</code> (bug fixes),
            <code class="font-mono">docs</code> (documentation),
            <code class="font-mono">style</code> (formatting),
            <code class="font-mono">refactor</code> (code improvements),
            <code class="font-mono">perf</code> (performance),
            <code class="font-mono">ci</code> (build/deploy),
            <code class="font-mono">chore</code> (maintenance).
        </p>
    </div>

    <details class="mb-4 group">
        <summary
            class="cursor-pointer flex items-center gap-2 p-4 bg-mondrian_white border border-mondrian_black hover:bg-mondrian_bright_white transition-colors [&::-webkit-details-marker]:hidden [&::marker]:hidden"
        >
            <svg
                class="w-4 h-4 transition-transform group-[[open]]:rotate-90"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
            >
                <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M9 5l7 7-7 7"
                />
            </svg>
            <span class="font-semibold text-sm"
                >About Versioning & Commit Messages</span
            >
            <span
                class="text-xs text-mondrian_dark_gray font-mono ml-auto hidden sm:inline"
                >Click to expand</span
            >
        </summary>

        <div
            class="p-4 border-x border-b border-mondrian_black bg-mondrian_bright_white space-y-2"
        >
            <p class="text-sm mb-2">
                This site uses
                <a
                    href="https://semver.org/"
                    class="underline hover:text-mondrian_red transition-colors"
                    target="_blank"
                    rel="noopener noreferrer"
                    title="Semantic Versioning"
                    aria-label="Learn more about Semantic Versioning"
                    >Semantic Versioning (SemVer)</a
                >
                to track changes. Unlike traditional software, this site
                combines both code and content, so the versioning reflects the
                overall user experience rather than just technical changes.
            </p>
            <p class="text-sm mb-2">
                I use
                <a
                    href="https://github.com/natrimmer/claude_commit"
                    class="underline hover:text-mondrian_red transition-colors"
                    target="_blank"
                    rel="noopener noreferrer"
                    title="Claude Commit"
                    aria-label="Visit the Claude Commit repository"
                    >Claude Commit</a
                >
                to generate commit messages using the
                <span class="code-inline">git diff</span> output and the Claude
                API.
            </p>

            <div
                class="p-4 bg-mondrian_black text-mondrian_yellow font-mono text-xs overflow-x-auto mb-2"
            >
                <p class="mb-2 text-mondrian_yellow">
                    [nick@web ~]$ bat semver.md
                </p>
                <div class="text-mondrian_dark_gray">
                    <div class="text-mondrian_yellow">
                        ───────┬──────────────────────────────────────────────────────
                    </div>
                    <div class="text-mondrian_yellow">
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;│ File:
                        semver.md
                    </div>
                    <div class="text-mondrian_yellow">
                        ───────┼──────────────────────────────────────────────────────
                    </div>
                    <div class="text-mondrian_yellow">
                        &nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;│&nbsp;<span
                            class="text-mondrian_yellow"
                            >## MAJOR</span
                        >
                        (2.0.0) - Breaking changes
                    </div>
                    <div class="text-mondrian_dark_gray">
                        &nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;│&nbsp;• Complete
                        visual redesigns
                    </div>
                    <div class="text-mondrian_dark_gray">
                        &nbsp;&nbsp;&nbsp;3&nbsp;&nbsp;&nbsp;│&nbsp;• URL
                        structure changes (old bookmarks break)
                    </div>
                    <div class="text-mondrian_dark_gray">
                        &nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;│&nbsp;• Removing
                        major sections or features
                    </div>
                    <div class="text-mondrian_dark_gray">
                        &nbsp;&nbsp;&nbsp;5&nbsp;&nbsp;&nbsp;│&nbsp;• Navigation
                        overhauls
                    </div>
                    <div class="text-mondrian_dark_gray">
                        &nbsp;&nbsp;&nbsp;6&nbsp;&nbsp;&nbsp;│&nbsp;
                    </div>
                    <div class="text-mondrian_yellow">
                        &nbsp;&nbsp;&nbsp;7&nbsp;&nbsp;&nbsp;│&nbsp;<span
                            class="text-mondrian_yellow"
                            >## MINOR</span
                        >
                        (1.3.0) - New features
                    </div>
                    <div class="text-mondrian_dark_gray">
                        &nbsp;&nbsp;&nbsp;8&nbsp;&nbsp;&nbsp;│&nbsp;• New
                        content sections (blogroll, notes)
                    </div>
                    <div class="text-mondrian_dark_gray">
                        &nbsp;&nbsp;&nbsp;9&nbsp;&nbsp;&nbsp;│&nbsp;• New
                        functionality (search, RSS, commenting)
                    </div>
                    <div class="text-mondrian_dark_gray">
                        &nbsp;&nbsp;10&nbsp;&nbsp;&nbsp;│&nbsp;• Significant
                        content additions
                    </div>
                    <div class="text-mondrian_dark_gray">
                        &nbsp;&nbsp;11&nbsp;&nbsp;&nbsp;│&nbsp;• New interactive
                        features
                    </div>
                    <div class="text-mondrian_dark_gray">
                        &nbsp;&nbsp;12&nbsp;&nbsp;&nbsp;│&nbsp;
                    </div>
                    <div class="text-mondrian_yellow">
                        &nbsp;&nbsp;13&nbsp;&nbsp;&nbsp;│&nbsp;<span
                            class="text-mondrian_yellow"
                            >## PATCH</span
                        >
                        (1.2.1) - Small fixes
                    </div>
                    <div class="text-mondrian_dark_gray">
                        &nbsp;&nbsp;14&nbsp;&nbsp;&nbsp;│&nbsp;• Bug fixes and
                        styling tweaks
                    </div>
                    <div class="text-mondrian_dark_gray">
                        &nbsp;&nbsp;15&nbsp;&nbsp;&nbsp;│&nbsp;• Individual blog
                        posts or notes
                    </div>
                    <div class="text-mondrian_dark_gray">
                        &nbsp;&nbsp;16&nbsp;&nbsp;&nbsp;│&nbsp;• Typo
                        corrections
                    </div>
                    <div class="text-mondrian_dark_gray">
                        &nbsp;&nbsp;17&nbsp;&nbsp;&nbsp;│&nbsp;• Performance
                        improvements
                    </div>
                    <div class="text-mondrian_dark_gray">
                        &nbsp;&nbsp;18&nbsp;&nbsp;&nbsp;│&nbsp;• Minor design
                        adjustments
                    </div>
                    <div class="text-mondrian_yellow">
                        ───────┴──────────────────────────────────────────────────────
                    </div>
                </div>
            </div>
        </div>
    </details>
    {{- end -}} {{- end -}} {{- .Content -}}
</div>
{{- end -}}
