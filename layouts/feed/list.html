{{- define "main" -}}{{- if and (eq .Section "feed") (eq .RelPermalink "/feed/")
-}} {{- /* Custom home page content from _index.md */ -}}
<div class="mb-2">{{- .Content -}}</div>
{{- end -}}{{- /* Feed header and listing for all feed pages */ -}}{{- /*
Collect all descendant feed pages for counting and display */ -}}{{-
$allDescendantPages := slice -}}{{- $currentSection := . -}}{{- range
$.Site.RegularPages -}}{{- if eq .Type "feed" -}}{{- $isDescendant := false
-}}{{- if eq .CurrentSection $currentSection -}}{{- $isDescendant = true -}}{{-
else -}}{{- range .Ancestors -}}{{- if eq . $currentSection -}}{{- $isDescendant
= true -}}{{- end -}}{{- end -}}{{- end -}}{{- if $isDescendant -}}{{-
$allDescendantPages = $allDescendantPages | append . -}}{{- end -}}{{- end
-}}{{- end -}}

<div>
    <div
        class="flex flex-col sm:flex-row sm:justify-between w-full items-start sm:items-end gap-2 sm:gap-0"
    >
        <h3
            class="text-2xl sm:text-3xl font-semibold underline decoration-6 sm:decoration-8 decoration-mondrian_black"
        >
            Feed
        </h3>
        <div class="text-left sm:text-right">
            <span class="h-max">
                <p class="text-sm sm:text-xs font-mono text-mondrian_dark_gray">
                    {{- len $allDescendantPages -}} {{- if eq (len
                    $allDescendantPages) 1 }} item {{- else }} items {{- end -}}
                </p>
            </span>
        </div>
    </div>
</div>

{{- /* Show feed items with pagination */ -}}{{- $paginator := .Paginate (sort
$allDescendantPages ".Date" "desc") 10 -}}{{- if gt (len $paginator.Pages) 0 -}}
<section class="mt-4">
    <div class="font-mono text-xs sm:text-sm overflow-x-auto">
        {{- range $index, $page := $paginator.Pages -}}
        <article class="mb-4 last:mb-0">
            {{- /* Log header line */ -}}
            <div class="flex flex-wrap items-start gap-1 mb-1">
                <span class="text-mondrian_red"
                    >[{{ $page.Date.Format "2006-01-02T15:04:05Z07:00" }}]</span
                >
                <a
                    href="{{ $page.RelPermalink }}"
                    class="text-mondrian_blue hover:underline hover:text-mondrian_yellow transition-colors"
                >
                    entry={{ $page.Title }}
                </a>
                {{- with $page.Params.tags -}}
                <span>tags=[</span>
                {{- range $i, $tag := . -}} {{- if $i -}}<span>,</span>{{- end
                -}}
                <a
                    href="/tags/{{ $tag | urlize }}/"
                    class="hover:underline decoration-mondrian_yellow transition-colors hover:text-mondrian_yellow"
                >
                    {{ $tag }}
                </a>
                {{- end -}}
                <span>]</span>
                {{- end -}}
            </div>
            <div class="flex items-start gap-2">
                <span class="text-mondrian_dark_gray font-bold flex-shrink-0"
                    >›</span
                >
                <div class="flex-1">{{- $page.Content -}}</div>
            </div>
        </article>
        {{- end -}}
    </div>

    {{- /* Pagination */ -}}{{- if gt $paginator.TotalPages 1 -}}
    <nav class="flex justify-center mt-4">
        <div class="flex items-center gap-1">
            {{- if $paginator.HasPrev -}}
            <a
                href="{{ $paginator.Prev.URL }}"
                class="px-3 py-2 sm:py-1 text-sm sm:text-xs border border-mondrian_black shadow-mondrian font-mono transition-colors bg-mondrian_white hover:bg-mondrian_blue hover:text-mondrian_white"
            >
                ← NEWER</a
            >
            {{- end -}}{{- range $paginator.Pagers -}}{{- if eq . $paginator -}}
            <span
                class="px-3 py-2 sm:py-1 text-sm sm:text-xs bg-mondrian_red text-mondrian_bright_white border border-mondrian_black font-mono"
            >
                {{- .PageNumber -}}
            </span>
            {{- else -}}
            <a
                href="{{ .URL }}"
                class="px-3 py-2 sm:py-1 text-sm sm:text-xs border border-mondrian_black shadow-mondrian font-mono transition-colors bg-mondrian_white hover:bg-mondrian_yellow"
            >
                {{- .PageNumber -}}
            </a>
            {{- end -}}{{- end -}}{{- if $paginator.HasNext -}}
            <a
                href="{{ $paginator.Next.URL }}"
                class="px-3 py-2 sm:py-1 text-sm sm:text-xs border border-mondrian_black shadow-mondrian font-mono transition-colors bg-mondrian_white hover:bg-mondrian_blue hover:text-mondrian_white"
            >
                OLDER →
            </a>
            {{- end -}}
        </div>
    </nav>
    {{- end -}}
</section>
{{- end -}}{{- /* Show subsections (years/months/days) if they exist */ -}}{{-
if .Sections -}}
<section class="mb-4 mt-4">
    <h4 class="text-lg font-semibold mb-2">
        Browse by {{- if eq .RelPermalink "/feed/" }} Year {{- else if (findRE
        "^/feed/[^/]+/$" .RelPermalink) }} Month {{- else }} Day {{- end -}}
    </h4>
    <div class="flex flex-wrap gap-2">
        {{- range .Sections.ByTitle.Reverse -}}{{- $section := . -}}{{-
        $totalPages := 0 -}}{{- range $.Site.RegularPages -}}{{- if eq .Type
        "feed" -}}{{- $isInSection := false -}}{{- if eq .CurrentSection
        $section -}}{{- $isInSection = true -}}{{- else -}}{{- range .Ancestors
        -}}{{- if eq . $section -}}{{- $isInSection = true -}}{{- end -}}{{- end
        -}}{{- end -}}{{- if $isInSection -}}{{- $totalPages = add $totalPages 1
        -}}{{- end -}}{{- end -}}{{- end -}}
        <a
            href="{{ .Page.RelPermalink }}"
            class="w-max py-2 sm:py-1 px-2 sm:px-1 text-sm sm:text-xs border border-mondrian_black shadow-mondrian font-mono transition-colors bg-mondrian_white hover:bg-mondrian_blue hover:text-mondrian_white text-center focus:outline focus:outline-offset-2 focus:outline-mondrian_blue"
        >
            {{- .Title -}}
            <span class="text-sm sm:text-xs opacity-75">
                [{{ $totalPages }} {{ if eq $totalPages 1 }}item{{ else
                }}items{{ end }}]
            </span>
        </a>
        {{- end -}}
    </div>
</section>
{{- end -}}{{- end -}}
