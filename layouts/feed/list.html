{{define "main"}} {{if and (eq .Section "feed") .IsHome}} {{/* Custom home page
content from _index.html */}} {{.Content}} {{else}} {{/* Standard header for
other feed pages */}} {{/* Collect all descendant feed pages for counting and
display */}} {{$allDescendantPages := slice}}{{$currentSection := .}} {{range
$.Site.RegularPages}} {{if eq .Type "feed"}} {{$isDescendant := false}} {{if eq
.CurrentSection $currentSection}} {{$isDescendant = true}} {{else}} {{range
.Ancestors}} {{if eq . $currentSection}} {{$isDescendant = true}} {{end}}
{{end}} {{end}} {{if $isDescendant}} {{$allDescendantPages = $allDescendantPages
| append .}} {{end}} {{end}} {{end}}
<div>
    <div class="flex justify-between w-full items-end">
        <h3
            class="text-3xl font-semibold underline decoration-8 decoration-mondrian_black"
        >
            Feed
        </h3>
        <div class="text-right mb-1">
            <span class="h-max pb-1">
                <p class="text-xs font-mono text-gray-500">
                    {{len $allDescendantPages}} {{if eq (len
                    $allDescendantPages) 1}} item {{else}} items {{end}}
                </p>
            </span>
        </div>
    </div>
</div>
{{end}} {{/* Collect all descendant feed pages for pagination */}} {{if not (and
(eq .Section "feed") .IsHome)}} {{$allDescendantPages :=
slice}}{{$currentSection := .}} {{range $.Site.RegularPages}} {{if eq .Type
"feed"}} {{$isDescendant := false}} {{if eq .CurrentSection $currentSection}}
{{$isDescendant = true}} {{else}} {{range .Ancestors}} {{if eq .
$currentSection}} {{$isDescendant = true}} {{end}} {{end}} {{end}} {{if
$isDescendant}} {{$allDescendantPages = $allDescendantPages | append .}} {{end}}
{{end}} {{end}} {{/* Show feed items with pagination */}} {{$paginator :=
.Paginate (sort $allDescendantPages ".Date" "desc") 10}} {{if gt (len
$paginator.Pages) 0}}
<section class="mt-4">
    <div>
        {{range $paginator.Pages}}
        <article
            class="hover:bg-white border border-mondrian_white hover:border-mondrian_black transition-colors mb-2 p-1"
        >
            <div class="flex">
                <div class="w-8 mr-4">
                    <a
                        href="{{ .RelPermalink }}"
                        class="h-min shadow-mondrian px-1 py-0.5 text-black border border-black font-mono transition-colors bg-mondrian_white hover:bg-mondrian_red hover:text-mondrian_white text-xs"
                    >
                        {{.Title}}</a
                    >
                </div>
                <div class="flex-col w-full">
                    <div class="text-sm leading-relaxed mb-1">
                        {{.Content}}
                        <hr class="w-full border-black" />
                    </div>
                    <footer
                        class="flex flex-wrap items-center gap-3 text-xs font-mono text-gray-500"
                    >
                        <span
                            >{{.Date.Format "2006-01-02"}}{{.Date.Format
                            "15:04"}}</span
                        >
                        {{with .Params.tags}}
                        <div class="flex flex-wrap gap-1">
                            {{range .}}
                            <a
                                href="/tags/{{ . | urlize }}/"
                                class="hover:underline decoration-mondrian_yellow transition-colors hover:text-mondrian_black"
                            >
                                #{{.}}</a
                            >
                            {{end}}
                        </div>
                        {{end}}
                    </footer>
                </div>
            </div>
        </article>
        {{end}}
    </div>
    {{/* Pagination */}} {{if gt $paginator.TotalPages 1}}
    <nav class="flex justify-center mt-8">
        <div class="flex items-center gap-1">
            {{if $paginator.HasPrev}}
            <a
                href="{{ $paginator.Prev.URL }}"
                class="px-3 py-1 text-xs text-black border border-black shadow-mondrian font-mono transition-colors bg-mondrian_white hover:bg-mondrian_blue hover:text-mondrian_white"
            >
                ← NEWER</a
            >
            {{end}} {{range $paginator.Pagers}} {{if eq . $paginator}}
            <span
                class="px-3 py-1 text-xs bg-mondrian_red text-white border border-black font-mono"
                >{{.PageNumber}}</span
            >
            {{else}}
            <a
                href="{{ .URL }}"
                class="px-3 py-1 text-xs text-black border border-black shadow-mondrian font-mono transition-colors bg-mondrian_white hover:bg-mondrian_yellow"
            >
                {{.PageNumber}}</a
            >
            {{end}} {{end}} {{if $paginator.HasNext}}
            <a
                href="{{ $paginator.Next.URL }}"
                class="px-3 py-1 text-xs text-black border border-black shadow-mondrian font-mono transition-colors bg-mondrian_white hover:bg-mondrian_blue hover:text-mondrian_white"
            >
                OLDER →</a
            >
            {{end}}
        </div>
    </nav>
    {{end}}
</section>
{{end}}
<hr />
{{/* Show subsections (years/months/days) if they exist */}} {{if .Sections}}
<section class="my-2">
    <h4 class="text-lg font-semibold">
        Browse by {{if eq .RelPermalink "/feed/"}} Year {{else if (findRE
        "^/feed/[^/]+/$" .RelPermalink)}} Month {{else}} Day {{end}}
    </h4>
    <div class="flex flex-wrap gap-2">
        {{range .Sections.ByTitle.Reverse}} {{$section := .}}{{$totalPages :=
        0}} {{range $.Site.RegularPages}} {{if eq .Type "feed"}} {{$isInSection
        := false}} {{if eq .CurrentSection $section}} {{$isInSection = true}}
        {{else}} {{range .Ancestors}} {{if eq . $section}} {{$isInSection =
        true}} {{end}} {{end}} {{end}} {{if $isInSection}} {{$totalPages = add
        $totalPages 1}} {{end}} {{end}} {{end}}
        <a
            href="{{ .RelPermalink }}"
            class="py-1 px-1 text-xs text-black border border-black shadow-mondrian font-mono transition-colors bg-mondrian_white hover:bg-mondrian_blue hover:text-mondrian_white text-center focus:outline focus:outline-offset-2 focus:outline-mondrian_blue"
        >
            {{.Title}}<span class="text-xs opacity-75"
                >[{{$totalPages}} {{if eq $totalPages 1}} item {{else}} items
                {{end}} ]</span
            ></a
        >
        {{end}}
    </div>
</section>
{{end}} {{end}} {{end}}
